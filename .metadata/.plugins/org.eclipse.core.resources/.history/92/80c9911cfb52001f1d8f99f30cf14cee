package com.healsmart.services;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.healsmart.dtos.EmployeeDTO;
import com.healsmart.entities.Employee;
import com.healsmart.entities.User;
import com.healsmart.repositories.DoctorRepository;
import com.healsmart.repositories.EmployeeRepository;
import com.healsmart.repositories.UserRepository;

@Service
@Transactional
public class EmployeeServiceImpl implements EmployeeService{
	@Autowired
	private EmployeeRepository employeeRepository;
	
	@Autowired
	private UserRepository userRepository;
	
	@Autowired
	private DoctorRepository doctorRepository;
	

	@Override
	public Employee addEmployee(EmployeeDTO empDTO) {
		if(!userRepository.existsByEmail(empDTO.getEmail())) {
			if(empDTO.getRole().equalsIgnoreCase("doctor")) {
				userRepository.insertIntoUsers(0, empDTO.getFirstName(), empDTO.getLastName(), empDTO.getEmail(), empDTO.getPassword(), empDTO.getCellNo(), empDTO.getRole(), empDTO.getSecurityQuestion(), empDTO.getSecurityAnswer());
				User user=userRepository.findByEmail(empDTO.getEmail());//to get userId
				System.out.println("user id : "+user.getUserId());
				Employee updateCount=employeeRepository.insertIntoEmployeesTable(0, user.getUserId(), empDTO.getDob(), empDTO.getHireDate(), empDTO.getSalary());
					Long empId=employeeRepository.getEmpIdByEmail(empDTO.getEmail());
					System.out.println("emp id : "+empId);
					doctorRepository.insertIntoDoctorTable(0, empId, empDTO.getDoctorCharges());
				return updateCount;
			}
			else {
				
			}
		}
		return null;
	}

	@Override
	public List<EmployeeDTO> getAllEmployees() {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public void updateEmployee(EmployeeDTO employeeDTO) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void deleteUserByCellNoAndUserId(EmployeeDTO userData) {
		// TODO Auto-generated method stub
		
	}

}
